<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>대기현황 | 롯데월드 어드벤처</title>
    <link rel="icon" type="image/x-icon" href="https://adventure.lotteworld.com/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(90deg, #9536de, #fc42c4);
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 750px;
            width: 100%;
            height: calc(100% - 40px);
            max-height: calc(100% - 40px);
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 60px rgba(0,0,0,0.3);
            overflow: hidden;
            border-radius: 24px;
        }

        .header {
            padding: 25px 30px 20px 30px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .logo {
            width: 38px;
            height: 38px;
            object-fit: contain;
        }

        h1 {
            color: #222;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .update-time {
            color: #999;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            letter-spacing: -0.2px;
        }

        .attractions-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            padding: 30px;
            background: #f8f8f8;
        }

        .attractions-grid::-webkit-scrollbar {
            width: 8px;
        }

        .attractions-grid::-webkit-scrollbar-track {
            background: transparent;
        }

        .attractions-grid::-webkit-scrollbar-thumb {
            background: #d0d0d0;
            border-radius: 4px;
        }

        .attractions-grid::-webkit-scrollbar-thumb:hover {
            background: #b0b0b0;
        }

        .attraction-card {
            background: white;
            border-radius: 14px;
            padding: 22px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            min-height: 62px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .attraction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .attraction-card:active {
            transform: translateY(0);
        }

        .attraction-left {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
            flex-wrap: wrap;
        }


        .attraction-name {
            font-size: 16.5px;
            font-weight: 700;
            color: #333;
            line-height: 1.4;
            letter-spacing: -0.3px;
        }

        .attraction-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .status {
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 12px;
            white-space: nowrap;
            letter-spacing: -0.2px;
        }

        .status.red {
            color: #ee1c00;
            background-color: rgba(238, 28, 0, 0.1);
        }

        .status.green {
            color: #00a92d;
            background-color: rgba(0, 169, 45, 0.1);
        }

        .status.single-rider {
            color: #7057ff;
            background-color: rgba(112, 87, 255, 0.1);
        }

        .wait-time {
            font-size: 16px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 12px;
            white-space: nowrap;
            letter-spacing: -0.3px;
        }

        .wait-time.green {
            color: #00a92d;
            background-color: rgba(0, 169, 45, 0.1);
        }

        .wait-time.yellow {
            color: #f39c12;
            background-color: rgba(243, 156, 18, 0.1);
        }

        .wait-time.orange {
            color: #ff8c00;
            background-color: rgba(255, 140, 0, 0.1);
        }

        .wait-time.red {
            color: #ee1c00;
            background-color: rgba(238, 28, 0, 0.1);
        }

        .footer {
            padding: 13px 15px;
            background: white;
            flex-shrink: 0;
            text-align: center;
            border-top: 1px solid #f0f0f0;
        }

        .footer p {
            color: #999;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: -0.2px;
            line-height: 1.5;
            margin: 0 0 2px 0;
            text-align: center;
        }

        .footer .credit {
            color: #bbb;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: -0.1px;
            margin: 0;
            text-align: center;
        }

        .footer a {
            color: #999;
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 2px;
            transition: color 0.2s ease;
        }

        .footer a:hover {
            color: #7057ff;
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 700px;
                height: calc(100% - 40px);
                max-height: calc(100% - 40px);
            }

            .header {
                padding: 23px 30px 18px 30px;
                gap: 7px;
            }

            .header-top {
                gap: 11px;
            }

            h1 {
                font-size: 26px;
                letter-spacing: -0.4px;
            }

            .logo {
                width: 36px;
                height: 36px;
            }

            .update-time {
                font-size: 12px;
                font-weight: 600;
            }

            .attraction-card {
                padding: 21px;
                min-height: 58px;
            }

            .attraction-name {
                font-size: 15px;
                letter-spacing: -0.25px;
            }

            .wait-time {
                font-size: 15px;
                letter-spacing: -0.25px;
            }

            .status {
                font-size: 12px;
                letter-spacing: -0.2px;
            }

            .footer {
                padding: 12px 15px;
            }

            .footer p {
                font-size: 12px;
                font-weight: 500;
                margin: 0 0 2px 0;
                text-align: center;
            }

            .footer .credit {
                font-size: 9px;
                margin: 0;
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }

            .header {
                padding: 16px 18px 14px 18px;
                gap: 6px;
            }

            .header-top {
                gap: 10px;
            }

            h1 {
                font-size: 24px;
                letter-spacing: -0.4px;
            }

            .logo {
                width: 34px;
                height: 34px;
            }

            .update-time {
                font-size: 11px;
                font-weight: 600;
            }

            .attractions-grid {
                padding: 15px;
                gap: 12px;
            }

            .attraction-card {
                padding: 18px;
                gap: 14px;
                border-radius: 12px;
                min-height: 58px;
            }

            .attraction-left {
                gap: 6px;
            }

            .attraction-right {
                gap: 10px;
            }

            .attraction-name {
                font-size: 15px;
                letter-spacing: -0.25px;
            }

            .status {
                font-size: 11px;
                padding: 4px 8px;
            }

            .wait-time {
                font-size: 15px;
                padding: 5px 11px;
                border-radius: 10px;
                letter-spacing: -0.25px;
            }


            .footer {
                padding: 11px 15px;
            }

            .footer p {
                font-size: 11px;
                font-weight: 500;
                margin: 0 0 2px 0;
                text-align: center;
            }

            .footer .credit {
                font-size: 8px;
                margin: 0;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0;
            }

            .container {
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }

            .header {
                padding: 13px 15px 12px 15px;
                gap: 5px;
            }

            .header-top {
                gap: 9px;
            }

            h1 {
                font-size: 22px;
                letter-spacing: -0.35px;
            }

            .logo {
                width: 32px;
                height: 32px;
            }

            .update-time {
                font-size: 10px;
                font-weight: 600;
            }

            .attractions-grid {
                padding: 15px;
                gap: 10px;
            }

            .attraction-card {
                padding: 16px;
                gap: 12px;
                border-radius: 11px;
                min-height: 54px;
            }

            .attraction-left {
                gap: 5px;
            }

            .attraction-right {
                gap: 8px;
            }

            .attraction-name {
                font-size: 14px;
                letter-spacing: -0.2px;
            }

            .status {
                font-size: 10px;
                padding: 4px 7px;
            }

            .wait-time {
                font-size: 14px;
                padding: 5px 10px;
                border-radius: 9px;
                letter-spacing: -0.2px;
            }


            .footer {
                padding: 10px 15px;
            }

            .footer p {
                font-size: 10px;
                font-weight: 500;
                margin: 0 0 2px 0;
                text-align: center;
            }

            .footer .credit {
                font-size: 7px;
                margin: 0;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <img src="https://adventure.lotteworld.com/assets/time-hSflU71B.png" alt="롯데월드" class="logo">
                <h1>롯데월드 어드벤처 대기현황</h1>
            </div>
            <div class="update-time" id="updateTime"></div>
        </div>
        <div class="attractions-grid" id="attractionsGrid"></div>
        <div class="footer">
            <p><a href="https://adventure.lotteworld.com/" target="_blank">롯데월드 어드벤처</a>에서 운영하는 사이트가 아닙니다.</p>
            <p class="credit">Made by Lee Jieun</p>
        </div>
    </div>

    <script>
        window.onbeforeunload = function (e) {
            return 0;
        };

        function getStatusColor(status) {
            if (!status) return 'green';
            const redStatuses = ['운행준비', '운행마침', '정기점검', '일시점검', '일일점검', '중간점검', '정기운휴', '예약 마감', '마감', '트랙건조', '우천대기', '폭설대기', '폭염대기', '혹한대기'];
            const greenStatuses = ['정상운행', '예약 가능'];
            
            if (redStatuses.some(rs => status.includes(rs))) return 'red';
            if (greenStatuses.some(gs => status.includes(gs))) return 'green';
            return 'red';
        }

        function getWaitTimeColor(waitTime) {
            if (waitTime <= 30) return 'green';
            if (waitTime <= 60) return 'yellow';
            if (waitTime <= 90) return 'orange';
            return 'red';
        }

        function getSortPriority(attraction) {
            const status = attraction.atrctSttsCdNm || '';
            const name = attraction.mstAtrctNm || '';
            const waitTime = attraction.waitTm ? parseInt(attraction.waitTm.trim()) : 0;
            
            const middlePriorityNames = ['문보트', '툼 오브 호러', '게임팩토리', '게임빌리지'];
            if (middlePriorityNames.some(mn => name.includes(mn))) return 500000;
            
            const closedStatuses = ['우천대기', '혹한대기', '폭설대기', '폭염대기', '트랙건조', '일시점검', '일일점검', '정기점검', '중간점검', '정기운휴', '운행마침', '운행종료'];
            if (closedStatuses.some(cs => status.includes(cs))) return 1000000;
            
            if (waitTime > 0) return waitTime;
            return 600000;
        }

        async function loadAttractions() {
            try {
                const response = await fetch('https://adventure.lotteworld.com/api/enjoy/attrctn/list', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        srchBrdngResvYn: "",
                        srchPstnCd: "",
                        srchSnglYn: "",
                        srchAcmpyYn: "",
                        srchMtntYn: "",
                        srchInfntEquYn: "",
                        srchTall: 0,
                        srchAtrctSttsCd: "",
                        srchTagList: [],
                        srchChoiceCnt: 0,
                        shopSysCd: "",
                        storeCd: "HC01801",
                        langCd: "HC01701",
                        deviceType: "mobile"
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const attractionsGrid = document.getElementById('attractionsGrid');
                let attractions = data.pifAtrctMstVoList || [];

                attractions = attractions.map((attraction, index) => ({
                    ...attraction,
                    originalIndex: index
                })).sort((a, b) => {
                    const priorityA = getSortPriority(a);
                    const priorityB = getSortPriority(b);
                    if (priorityA !== priorityB) return priorityA - priorityB;
                    return a.originalIndex - b.originalIndex;
                });

                attractionsGrid.innerHTML = '';
                const fragment = document.createDocumentFragment();

                attractions.forEach(attraction => {
                    const card = document.createElement('div');
                    card.className = 'attraction-card';

                    const shopSysCd = attraction.shopSysCd;
                    if (shopSysCd) {
                        card.onclick = () => {
                            window.open(`https://adventure.lotteworld.com/enjoy/attrctn/detail?shopSysCd=${shopSysCd}`, '_blank');
                        };
                    }

                    const leftDiv = document.createElement('div');
                    leftDiv.className = 'attraction-left';

                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'attraction-name';
                    nameDiv.textContent = attraction.mstAtrctNm;
                    leftDiv.appendChild(nameDiv);

                    const status = attraction.atrctSttsCdNm;
                    const waitTime = attraction.waitTm ? parseInt(attraction.waitTm.trim()) : 0;
                    const name = attraction.mstAtrctNm;

                    const singleRiderAttractions = ['아트란티스', '스페인해적선', '후렌치레볼루션'];
                    const isSingleRider = singleRiderAttractions.some(sr => name.includes(sr)) && !name.includes('5G');

                    if (isSingleRider) {
                        const singleRiderSpan = document.createElement('span');
                        singleRiderSpan.className = 'status single-rider';
                        singleRiderSpan.textContent = '싱글라이더';
                        leftDiv.appendChild(singleRiderSpan);
                    }

                    const operatingStatuses = ['예약 마감', '예약 가능', '대기 마감', '대기마감'];
                    const isOperating = status && operatingStatuses.some(s => status.includes(s));

                    if (isOperating) {
                        const statusSpan = document.createElement('span');
                        statusSpan.className = 'status';
                        statusSpan.classList.add(getStatusColor(status));
                        statusSpan.textContent = status;
                        leftDiv.appendChild(statusSpan);
                    }

                    card.appendChild(leftDiv);

                    const rightDiv = document.createElement('div');
                    rightDiv.className = 'attraction-right';

                    const weatherStatuses = ['우천대기', '폭설대기', '폭염대기', '혹한대기'];
                    const hasWeatherStatus = status && weatherStatuses.some(ws => status.includes(ws));
                    const isMaintenanceOrClosed = status && (status.includes('점검') || status.includes('운행종료') || status.includes('운행마침') || status.includes('운휴') || status.includes('트랙건조') || hasWeatherStatus);
                    if (waitTime > 0 && !isMaintenanceOrClosed) {
                        const waitSpan = document.createElement('span');
                        waitSpan.className = 'wait-time';
                        waitSpan.classList.add(getWaitTimeColor(waitTime));
                        waitSpan.textContent = `${waitTime}분`;
                        rightDiv.appendChild(waitSpan);
                    }

                    if (status && status !== '정상운행' && status !== '운행준비' && !isOperating) {
                        const statusSpan = document.createElement('span');
                        statusSpan.className = 'status';
                        statusSpan.classList.add(getStatusColor(status));
                        statusSpan.textContent = status;
                        rightDiv.appendChild(statusSpan);
                    }

                    card.appendChild(rightDiv);
                    fragment.appendChild(card);
                });

                attractionsGrid.appendChild(fragment);

                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth() + 1;
                const day = now.getDate();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('updateTime').textContent = `${year}년 ${month}월 ${day}일 ${hours}:${minutes} 기준`;
            } catch (error) {
                console.error('데이터 로드 오류:', error);
                document.getElementById('attractionsGrid').innerHTML = 
                    '<p style="text-align: center; color: #e74c3c; padding: 20px; font-weight: 700;">데이터를 불러오는데 실패했습니다.</p>';
            }
        }

        loadAttractions();
    </script>
</body>
</html>
